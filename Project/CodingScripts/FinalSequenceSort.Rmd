---
title: "Low_High_Mut_R"
output: html_document
date: "2022-10-31"
---
#uploading data and defining a column 
```{r}
SeqData <- read.table('//Users/nagendra//Desktop//Bioinformatics//Project//Data//ACTG5257_RT_fasta.txt',header=FALSE,fill=TRUE) 
WeekNumber <- SeqData$V1

```


INDEXING to clean up raw data

```{r}
idx <- c()
#trying to move sequences for day0 and end day for each patient to a different dataframe
#Loop comments
#making sure the patient names are the same, the day for the row is 0 
#making sure the indexed box is not empty or NA
for(h in 1:length(SeqData$V1)){
  if(SeqData$V5[h]==SeqData$V5[h+2] && SeqData$V8[h] == 0 && is.na(SeqData$V8[h])==FALSE && SeqData$V5[h]!= "" && SeqData$V8[h]!=SeqData$V8[h+2]){
    #if all those conditions are met, the row number is indexed and saved in idx
    idx <- append(idx, h)
  }
}
  
StartSeq<- SeqData$V1[idx+1]
EndSeq <- SeqData$V1[idx+3]
PTID <- SeqData$V5[idx]
StartDayNumber <- SeqData$V8[idx]
EndDayNumber <- SeqData$V8[idx+2]

```

Making a dataframe with the saved rows
```{r}
# making a dataframe with start and end FASTA data, patient ID, start week, and end week
CompleteDF <- data.frame(StartSeq, EndSeq, PTID, StartDayNumber, EndDayNumber)
```

Removing periods before nucleotide sequences
```{r}
#sequences are flanked by periods. Script removes the periodas
CompleteDF$StartSeq <- gsub("\\.","", CompleteDF$StartSeq)
CompleteDF$EndSeq <- gsub("\\.","", CompleteDF$EndSeq)
```

Saving dataframe to a text file
```{r}

write.table(CompleteDF,'/Users/nagendra/Desktop/Bioinformatics/Project/Data/DataForBLAST.csv', sep = ",")
```

!!!NOTE!!! Between these two steps, the data frame above was opened in excel and formatted as FASTA data again to run through the blast link below. The input for blast is named as FinalBlastInput. The output generated after running this file through blast is named as BLAST final alignment. 

https://blast.ncbi.nlm.nih.gov/Blast.cgi?BLAST_SPEC=blast2seq&LINK_LOC=align2seq&PAGE_TYPE=BlastSearch 

Uploading blast sequence data
```{r}
BLAST <- read.table('/Users/nagendra/Desktop/Bioinformatics/Project/Data/BLASTFinalAlignment.csv', sep= ",")
```


Getting Blast sequences cleaned up 
```{r}
#code to save line numbers that have the same patient ID in both rows. 
ydx<-c()
for(z in 1:length(BLAST$V1)){
  if(BLAST$V1[z]==BLAST$V2[z]){
   ydx <- append(ydx,z) 
  }
}
#creating vectors out of the indexed numbers to be used to make a dataframe.  
PatientName <- BLAST$V1[ydx]
SimilarityPct <- BLAST$V3[ydx]
BPlength <- BLAST$V4[ydx]

```

Making comparison BLAST dataframe
```{r}
#making a dataframe with patient ID, percent similarity, base pair length, and the end day 
BLASTCompare <- data.frame(PatientName, SimilarityPct, BPlength, EndDayNumber)
```


